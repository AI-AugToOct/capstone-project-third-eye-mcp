FROM node:20-alpine AS base

ENV PNPM_HOME=/pnpm \
    PATH="${PNPM_HOME}:$PATH"

RUN corepack enable

WORKDIR /app

COPY pnpm-workspace.yaml pnpm-lock.yaml ./
COPY apps/control-plane/package.json apps/control-plane/package.json

RUN pnpm install --filter overseer-control-plane --frozen-lockfile --prefer-offline --workspace-root

COPY apps/control-plane ./apps/control-plane

EXPOSE 5174

CMD ["pnpm", "--filter", "overseer-control-plane", "dev", "--host", "0.0.0.0", "--port", "5174"]
